---
import ImageWrapper from "../components/misc/ImageWrapper.astro";
import I18nKey from "../i18n/i18nKey";
import { i18n } from "../i18n/translation";
import MainGridLayout from "../layouts/MainGridLayout.astro";
import "sakana-widget/lib/index.css";
import SakanaWidget from "sakana-widget";

// 追番数据  completed 看完   watching 在追
const animeList = [
	{
		title: "沉默魔女的秘密",
		status: "watching",
		rating: 4,
		cover:
			"https://bili-proxy.api.chenhen.top/bfs/openplatform/e32ed446c1f02f7e6c2c9600ca4b6eb561e898bf.png@384w_512h.webp",
		description:
			"人类必须通过咏唱，才能使用魔法。但有一个少女，却打破了这个定律。“七贤人”，是里迪尔王国的七位最强魔法师，其中之一是……",
		episodes: "13 episodes",
		year: "2025-2026",
		link: "https://www.bilibili.com/bangumi/media/md26625039",
		review: "魔法波奇，可爱",
	},
	{
		title: "夏日口袋",
		status: "watching",
		rating: 5,
		cover:
			"https://bili-proxy.api.chenhen.top/bfs/openplatform/e549a7f75f3bcab529fdce4014a28c3279aeffa4.png@384w_512h.webp",
		description:
			"主人公鹰原羽依里为了整理已故祖母的遗物，利用暑假时间独自来到了鸟白岛。当他走下一天只有几班的渡轮时，遇见了……",
		episodes: "30 episodes",
		year: "2025-2026",
		link: "https://www.bilibili.com/bangumi/media/md25572685",
		review: "有点烧脑，对上电波于是满分",
	},
	{
		title: "总之就是非常可爱 第二季",
		status: "watching",
		rating: 3,
		cover:
			"https://bili-proxy.api.chenhen.top/bfs/openplatform/bcb277f6787ea2216752a25f245488976b874752.png@384w_512h.webp",
		description:
			"[-人では形をなさぬ 二人の愛を誓い合うんだ」運命の出会いからのプロポ-ズ、ボロア八-トの新婚生活、結婚指輪に両親への挨拶からのアパ-ト全焼にもめげす",
		episodes: "16 episodes",
		year: "2023-2024",
		link: "https://www.bilibili.com/bangumi/media/md20266559",
		review: "甜过头了......超容易看厌的番",
	},
	{
		title: "怪兽8号",
		status: "watching",
		rating: 4,
		cover:
			"https://bili-proxy.api.chenhen.top/bfs/openplatform/119f272b7c3d7a59046aa988296d50de8fbd7f79.png@384w_512h.webp",
		description:
			"这是一个怪兽如日常般威胁人类的世界。日比野卡夫卡原本立志加入“日本防卫队”，却放弃梦想，在怪兽清扫公司工作……",
		episodes: "16 episodes",
		year: "2024-2025",
		link: "https://www.bilibili.com/bangumi/media/md21231256",
		review: "没看完",
	},
	{
		title: "与游戏中心的少女异文化交流的故事",
		status: "watching",
		rating: 999,
		cover:
			"https://bili-proxy.api.chenhen.top/bfs/openplatform/45a1da7c7aca4f4d771689ddbfe50e1ec7fea1c2.png@362w_512h.webp",
		description: "ゲ-ムセンタ-でアルバイト中の青年・草壁蓮司が目にしたのは……",
		episodes: "16 episodes",
		year: "2025-2026",
		link: "https://bgm.tv/subject/510256",
		review: "かわいい，无需多言",
	},
	{
		title: "9-nine- 支配者的王冠",
		status: "watching",
		rating: 4,
		cover:
			"https://bili-proxy.api.chenhen.top/bfs/openplatform/f6e8d88cde62bac6db0ba4f3ce4853c4206b1661.png@362w_512h.webp",
		description:
			"白巳津川市。学園都市であること以外になんの特色もない街。観光客を……",
		episodes: "16 episodes",
		year: "2025-2026",
		link: "https://bgm.tv/subject/496973",
		review: "感觉剧情有点莫名其妙，能看下去",
	},
];

// 获取状态的翻译文本
function getStatusText(status: string): string {
	switch (status) {
		case "watching":
			return i18n(I18nKey.animeStatusWatching);
		case "completed":
			return i18n(I18nKey.animeStatusCompleted);
		default:
			return status;
	}
}
---

<MainGridLayout title={i18n(I18nKey.anime)} description="我的追番记录">
	<div class="flex w-full rounded-[var(--radius-large)] overflow-hidden relative min-h-32">
		<div class="card-base z-10 px-4 md:px-9 py-4 md:py-6 relative w-full">
			<div class="relative">
				<div class="flex flex-row items-center text-lg font-bold mb-4 md:mb-6 text-90">
					<div class="flex flex-row items-center">
						<svg class="w-5 h-5 md:w-6 md:h-6 mr-2 text-90" fill="currentColor" viewBox="0 0 24 24">
							<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
						</svg>
						<span>{i18n(I18nKey.anime)}</span>
					</div>
				</div>

				<!-- 统计信息 -->
				<div class="grid grid-cols-1 md:grid-cols-3 gap-3 md:gap-4 mb-6 md:mb-8">
					<div class="card-base p-3 md:p-4 text-center">
						<div class="text-xl md:text-2xl font-bold text-[var(--primary)]">{animeList.length}</div>
						<div class="text-xs md:text-sm text-75">{i18n(I18nKey.animeTotal)}</div>
					</div>
					<div class="card-base p-3 md:p-4 text-center">
						<div class="text-xl md:text-2xl font-bold text-[oklch(0.65_0.15_140)] dark:text-[oklch(0.75_0.15_140)]">{animeList.filter(anime => anime.status === 'watching').length}</div>
						<div class="text-xs md:text-sm text-75">{i18n(I18nKey.animeWatching)}</div>
					</div>
					<div class="card-base p-3 md:p-4 text-center">
						<div class="text-xl md:text-2xl font-bold text-[oklch(0.65_0.15_240)] dark:text-[oklch(0.75_0.15_240)]">{animeList.filter(anime => anime.status === 'completed').length}</div>
						<div class="text-xs md:text-sm text-75">{i18n(I18nKey.animeCompleted)}</div>
					</div>
				</div>

				<!-- 番剧列表 -->
				<div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
					{animeList.map(anime => (
						<div class="card-base p-4 md:p-6 flex flex-col min-w-0">
							<a href={anime.link} target="_blank" rel="noopener noreferrer" class="flex flex-1 block">
								<!-- 封面 -->
								<div class="ImageWrapper w-12 md:w-16 h-16 md:h-20 rounded-[var(--radius-medium)] overflow-hidden relative mr-4 md:mr-6 flex-shrink-0">
									<ImageWrapper 
										src={anime.cover} 
										alt={anime.title}
										class="w-full h-full object-cover"
									/>
								</div>

								<!-- 内容 -->
								<div class="flex-1 min-w-0">
									<h3 class="text-base md:text-lg font-bold mb-2 truncate text-90">{anime.title}</h3>
									<p class="text-xs md:text-sm text-75 mb-3 md:mb-4 line-clamp-2">{anime.description}</p>

									<!-- 评分和状态标签 -->
									<div class="flex items-center justify-between mb-3 md:mb-4">
										<div class="flex items-center">
											<div class="flex mr-2">
												{Array.from({length: 5}, (_, i) => (
													<svg class={`w-3 h-3 md:w-4 md:h-4 ${i < anime.rating ? 'text-[oklch(0.75_0.15_80)] dark:text-[oklch(0.85_0.15_80)]' : 'text-30'}`} fill="currentColor" viewBox="0 0 20 20">
														<path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
													</svg>
											))}
											</div>
											<span class="text-xs md:text-sm text-75">{anime.rating}/5</span>
										</div>

											<!-- 状态标签 -->
											<div class="flex items-center">
												<span class={`px-2 py-1 rounded-full text-xs font-medium ${
													anime.status === 'watching' ? 'bg-[oklch(0.85_0.1_140)] text-[oklch(0.35_0.15_140)] dark:bg-[oklch(0.25_0.1_140)] dark:text-[oklch(0.75_0.15_140)]' :
													anime.status === 'completed' ? 'bg-[oklch(0.85_0.1_240)] text-[oklch(0.35_0.15_240)] dark:bg-[oklch(0.25_0.1_240)] dark:text-[oklch(0.75_0.15_240)]' :
													'bg-[var(--btn-regular-bg)] text-75'
												}`}>{getStatusText(anime.status)}</span>
											</div>
										</div>
								</div>
							</a>

							<!-- 评价 -->
							<div class="group">
								<div class="border-t border-[var(--line-divider)] pt-3 md:pt-4 transition-all duration-300 group-hover:border-[var(--primary)] group-hover:pt-4 rounded-b-[var(--radius-medium)] bg-[var(--card-bg)] -mx-4 md:-mx-6 px-4 md:px-6 pb-2 md:pb-3">
									<h4 class="text-xs md:text-sm font-semibold mb-2 text-90 transition-colors duration-300 group-hover:text-[var(--primary)]">{i18n(I18nKey.animeReview)}</h4>
									<p class="text-xs md:text-sm text-75 line-clamp-2 transition-all duration-300 group-hover:text-90">{anime.review}</p>
								</div>
							</div>
						</div>
					))}
				</div>


			</div>
		</div>
	</div>
</MainGridLayout>

<style>
	.card-base {
		background: var(--card-bg);
		border: 1px solid var(--line-divider);
	}
</style>