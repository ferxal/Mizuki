---
import Analytics from "@vercel/analytics/astro";
import SpeedInsights from "@vercel/speed-insights/astro";

import { profileConfig } from "../config";
import { url } from "../utils/url-utils";

const currentYear = new Date().getFullYear();
---

<!--<div class="border-t border-[var(&#45;&#45;primary)] mx-16 border-dashed py-8 max-w-[var(&#45;&#45;page-width)] flex flex-col items-center justify-center px-6">-->
<div class="transition border-t border-black/10 dark:border-white/15 my-10 border-dashed mx-32"></div>
<!--<div class="transition bg-[oklch(92%_0.01_var(&#45;&#45;hue))] dark:bg-black rounded-2xl py-8 mt-4 mb-8 flex flex-col items-center justify-center px-6">-->
<div class="transition border-dashed border-[oklch(85%_0.01_var(--hue))] dark:border-white/15 rounded-2xl mb-12 flex flex-col items-center justify-center px-6">
    <div class="transition text-50 text-sm text-center">

        <div class="flex flex-wrap justify-center gap-3 mb-4">
            <a target="_blank" href="https://astro.build/" rel="external nofollow noreferrer noopener"><img title="åšå®¢æ¡†æ¶ä¸ºAstro" alt="åšå®¢æ¡†æ¶ä¸ºAstro" src="https://img.shields.io/badge/Frame-Astro-d021d6?style=flat&amp;logo=astro" data-ll-status="loading"></a>
            <a target="_blank" href="https://github.com/ferxal/MyBlog" rel="external nofollow noreferrer noopener"><img title="ä¸»é¢˜é‡‡ç”¨Mizuki" alt="ä¸»é¢˜é‡‡ç”¨Mizuki" src="https://img.shields.io/badge/Theme-Mizuki-6513df?style=flat&amp;logo=thumbtack" data-ll-status="loading"></a>
            <a target="_blank" href="https://www.cloudflare.com/" rel="external nofollow noreferrer noopener"><img title="Cloudflaretæä¾›åŠ é€Ÿä¸é˜²æŠ¤" alt="Cloudflaretæä¾›åŠ é€Ÿä¸é˜²æŠ¤" src="https://img.shields.io/badge/CDN-Cloudflare-f38020?style=flat&amp&logo=cloudflare" data-ll-status="loading"></a>
            <a target="_blank" href="https://www.netlify.com/" rel="external nofollow noreferrer noopener"><img title="æœ¬ç«™éƒ¨ç½²äºVercel" alt="æœ¬ç«™éƒ¨ç½²äºVercel" src="https://img.shields.io/badge/Hosted-Vercel-brightgreen?style=flat&amp;logo=Vercel" data-ll-status="loading"></a>
            <a target="_blank" href="https://github.com/" rel="external nofollow noreferrer noopener"><img title="æœ¬ç«™é¡¹ç›®ç”±Gtihubæ‰˜ç®¡" alt="æœ¬ç«™é¡¹ç›®ç”±Gtihubæ‰˜ç®¡" src="https://img.shields.io/badge/Source-Github-blue?style=flat&amp;logo=GitHub" data-ll-status="loading"></a>
            <a target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer noopener"><img title="æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯" alt="çŸ¥è¯†å…±äº«ç½²å" src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" data-ll-status="loading"></a>
        </div>

        <script type="text/javascript" src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script>
        <link rel="stylesheet" href="https://jsd-proxy.ygxz.in/gh/lipis/flag-icons@7.3.2/css/flag-icons.min.css" />
        <!--å¼•å…¥JQueryå’Œflag-iconsï¼Œå¦‚æœåˆ«å¤„å¼•å…¥è¿‡æ»¤ï¼Œå¯çœç•¥-->
        <div class="flex flex-wrap justify-center items-center gap-1 mt-4">
            <span>ä½ è¿æ¥çš„CDNèŠ‚ç‚¹æ˜¯ï¼š</span>
            <span id="cdn" class="font-medium inline-flex items-center gap-1">
                <span class="fi fi-xx fis mr-1"></span>æ£€æµ‹ä¸­...
            </span>
        </div>
        &copy; <span id="copyright-year">{currentYear}</span> {profileConfig.name} All Rights Reserved
        <!--åœ¨é€‚å½“çš„åœ°æ–¹æ”¾å…¥éœ€è¦æ˜¾ç¤ºCDNèŠ‚ç‚¹çš„ä¿¡æ¯-->
        <script>
            // æ£€æµ‹æ˜¯å¦ä¸ºç¦»çº¿ç¯å¢ƒ
            function isOfflineEnvironment() {
                const hostname = window.location.hostname;
                const offlinePatterns = [
                    '127.0.0.1',
                    'localhost',
                    '192.168.',
                    '10.',
                    '172.16.',
                    '172.17.',
                    '172.18.',
                    '172.19.',
                    '172.20.',
                    '172.21.',
                    '172.22.',
                    '172.23.',
                    '172.24.',
                    '172.25.',
                    '172.26.',
                    '172.27.',
                    '172.28.',
                    '172.29.',
                    '172.30.',
                    '172.31.'
                ];
                
                return offlinePatterns.some(pattern => hostname.startsWith(pattern));
            }

            // CDNä¿¡æ¯ç¼“å­˜ - ä½¿ç”¨sessionStorageæŒä¹…åŒ–
            let cdnInfoCache = null;
            let cdnInfoFetched = false;

            // ä»sessionStorageæ¢å¤ç¼“å­˜
            function restoreCache() {
                try {
                    const cached = sessionStorage.getItem('cdnInfoCache');
                    if (cached) {
                        cdnInfoCache = cached;
                        cdnInfoFetched = true;
                        return true;
                    }
                } catch (e) {
                    // å¿½ç•¥å­˜å‚¨é”™è¯¯
                }
                return false;
            }

            // ä¿å­˜ç¼“å­˜åˆ°sessionStorage
            function saveCache(content) {
                try {
                    sessionStorage.setItem('cdnInfoCache', content);
                } catch (e) {
                    // å¿½ç•¥å­˜å‚¨é”™è¯¯
                }
            }

            // å®šä¹‰CDNæ£€æµ‹å‡½æ•°
            function getCDNinfo() {
                // å¦‚æœå·²ç»è·å–è¿‡CDNä¿¡æ¯ï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜
                if (cdnInfoCache) {
                    updateAllCDNElements(cdnInfoCache);
                    return;
                }

                // é¦–å…ˆæ£€æŸ¥æ˜¯å¦ä¸ºç¦»çº¿ç¯å¢ƒ
                if (isOfflineEnvironment()) {
                    const offlineInfo = '<span class="text-gray-500">ğŸ–¥ï¸ ç¦»çº¿ç¯å¢ƒ</span>';
                    cdnInfoCache = offlineInfo;
                    cdnInfoFetched = true;
                    saveCache(offlineInfo);
                    updateAllCDNElements(offlineInfo);
                    return;
                }

                const locationMap = {
                    'HKG': {flag: 'hk', country: 'ä¸­å›½', name: 'é¦™æ¸¯'},
                    'NRT': {flag: 'jp', country: 'æ—¥æœ¬', name: 'ä¸œäº¬(æˆç”°)'},
                    'KIX': {flag: 'jp', country: 'æ—¥æœ¬', name: 'å¤§é˜ª'},
                    'SIN': {flag: 'sg', country: 'æ–°åŠ å¡', name: 'æ–°åŠ å¡'},
                    'TPE': {flag: 'tw', country: 'ä¸­å›½', name: 'å°åŒ—'},
                    'ICN': {flag: 'kr', country: 'éŸ©å›½', name: 'é¦–å°”'},
                    'BKK': {flag: 'th', country: 'æ³°å›½', name: 'æ›¼è°·'},
                    'DEL': {flag: 'in', country: 'å°åº¦', name: 'æ–°å¾·é‡Œ'},
                    'BOM': {flag: 'in', country: 'å°åº¦', name: 'å­Ÿä¹°'},
                    'SYD': {flag: 'au', country: 'æ¾³å¤§åˆ©äºš', name: 'æ‚‰å°¼'},
                    'MEL': {flag: 'au', country: 'æ¾³å¤§åˆ©äºš', name: 'å¢¨å°”æœ¬'},
                    'LAX': {flag: 'us', country: 'ç¾å›½', name: 'æ´›æ‰çŸ¶'},
                    'SJC': {flag: 'us', country: 'ç¾å›½', name: 'åœ£ä½•å¡'},
                    'DFW': {flag: 'us', country: 'ç¾å›½', name: 'è¾¾æ‹‰æ–¯'},
                    'ORD': {flag: 'us', country: 'ç¾å›½', name: 'èŠåŠ å“¥'},
                    'IAD': {flag: 'us', country: 'ç¾å›½', name: 'åç››é¡¿'},
                    'EWR': {flag: 'us', country: 'ç¾å›½', name: 'çº½çº¦'},
                    'AMS': {flag: 'nl', country: 'è·å…°', name: 'é˜¿å§†æ–¯ç‰¹ä¸¹'},
                    'FRA': {flag: 'de', country: 'å¾·å›½', name: 'æ³•å…°å…‹ç¦'},
                    'CDG': {flag: 'fr', country: 'æ³•å›½', name: 'å·´é»'},
                    'LHR': {flag: 'gb', country: 'è‹±å›½', name: 'ä¼¦æ•¦'},
                    'MAD': {flag: 'es', country: 'è¥¿ç­ç‰™', name: 'é©¬å¾·é‡Œ'},
                    'DXB': {flag: 'ae', country: 'é˜¿è”é…‹', name: 'è¿ªæ‹œ'},
                    'MAA': {flag: 'in', country: 'å°åº¦', name: 'é‡‘å¥ˆ'},
                    'BLR': {flag: 'in', country: 'å°åº¦', name: 'ç­åŠ ç½—å°”'},
                    'CGK': {flag: 'id', country: 'å°åº¦å°¼è¥¿äºš', name: 'é›…åŠ è¾¾'},
                    'KUL': {flag: 'my', country: 'é©¬æ¥è¥¿äºš', name: 'å‰éš†å¡'},
                    'MNL': {flag: 'ph', country: 'è²å¾‹å®¾', name: 'é©¬å°¼æ‹‰'},
                    'HAN': {flag: 'vn', country: 'è¶Šå—', name: 'æ²³å†…'},
                    'SGN': {flag: 'vn', country: 'è¶Šå—', name: 'èƒ¡å¿—æ˜å¸‚'},
                    'PNH': {flag: 'kh', country: 'æŸ¬åŸ”å¯¨', name: 'é‡‘è¾¹'},
                    'RUH': {flag: 'sa', country: 'æ²™ç‰¹é˜¿æ‹‰ä¼¯', name: 'åˆ©é›…å¾—'},
                    'DOH': {flag: 'qa', country: 'å¡å¡”å°”', name: 'å¤šå“ˆ'},
                    'TLV': {flag: 'il', country: 'ä»¥è‰²åˆ—', name: 'ç‰¹æ‹‰ç»´å¤«'},
                    'JNB': {flag: 'za', country: 'å—é', name: 'çº¦ç¿°å†…æ–¯å ¡'},
                    'CPT': {flag: 'za', country: 'å—é', name: 'å¼€æ™®æ•¦'},
                    'GRU': {flag: 'br', country: 'å·´è¥¿', name: 'åœ£ä¿ç½—'},
                    'EZE': {flag: 'ar', country: 'é˜¿æ ¹å»·', name: 'å¸ƒå®œè¯ºæ–¯è‰¾åˆ©æ–¯'},
                    'AKL': {flag: 'nz', country: 'æ–°è¥¿å…°', name: 'å¥¥å…‹å…°'},
                    'YVR': {flag: 'ca', country: 'åŠ æ‹¿å¤§', name: 'æ¸©å“¥å'},
                    'YYZ': {flag: 'ca', country: 'åŠ æ‹¿å¤§', name: 'å¤šä¼¦å¤š'}
                };
                
                // ä½¿ç”¨åŸç”Ÿfetchæ›¿ä»£jQueryçš„ajaxï¼Œæé«˜å…¼å®¹æ€§
                fetch("/cdn-cgi/trace")
                    .then(response => response.text())
                    .then(data => {
                        if(data && data.includes("colo=")) {
                            let code = data.split("colo=")[1].split("\n")[0];
                            let location = locationMap[code];
                            if(location) {
                                const cdnInfo = `<span class="fi fi-${location.flag} fis mr-1"></span>${location.country} ${location.name}`;
                                cdnInfoCache = cdnInfo;
                                cdnInfoFetched = true;
                                saveCache(cdnInfo);
                                updateAllCDNElements(cdnInfo);
                            } else {
                                const cdnInfo = `<span class="fi fi-xx fis mr-1"></span>${code}`;
                                cdnInfoCache = cdnInfo;
                                cdnInfoFetched = true;
                                saveCache(cdnInfo);
                                updateAllCDNElements(cdnInfo);
                            }
                        } else {
                            const cdnInfo = '<span class="fi fi-xx fis mr-1"></span>æœªçŸ¥';
                            cdnInfoCache = cdnInfo;
                            cdnInfoFetched = true;
                            saveCache(cdnInfo);
                            updateAllCDNElements(cdnInfo);
                        }
                    })
                    .catch(error => {
                        const cdnInfo = '<span class="text-yellow-500">ğŸ› ï¸ ç½‘ç»œé”™è¯¯</span>';
                        cdnInfoCache = cdnInfo;
                        cdnInfoFetched = true;
                        saveCache(cdnInfo);
                        updateAllCDNElements(cdnInfo);
                    });
            }

            // æ›´æ–°æ‰€æœ‰CDNå…ƒç´ çš„è¾…åŠ©å‡½æ•°
            function updateAllCDNElements(content) {
                const cdnElements = document.querySelectorAll('#cdn');
                cdnElements.forEach(cdnElement => {
                    if (cdnElement) {
                        cdnElement.innerHTML = content;
                    }
                });
            }

            // åˆå§‹åŒ–CDNæ£€æµ‹
            function initCDN() {
                // é¦–å…ˆå°è¯•ä»ç¼“å­˜æ¢å¤
                if (restoreCache()) {
                    updateAllCDNElements(cdnInfoCache);
                    return;
                }

                // å¦‚æœå·²ç»æœ‰ç¼“å­˜ä¿¡æ¯ï¼Œç›´æ¥ä½¿ç”¨
                if (cdnInfoCache) {
                    updateAllCDNElements(cdnInfoCache);
                    return;
                }

                // æ›´æ–°æ‰€æœ‰CDNå…ƒç´ ä¸ºæ£€æµ‹ä¸­çŠ¶æ€
                const cdnElements = document.querySelectorAll('#cdn');
                cdnElements.forEach(cdnElement => {
                    if (cdnElement) {
                        cdnElement.innerHTML = '<span class="fi fi-xx fis mr-1"></span>æ£€æµ‹ä¸­...';
                    }
                });

                // å¦‚æœè¿˜æ²¡è·å–è¿‡CDNä¿¡æ¯ï¼Œåˆ™è·å–
                if (!cdnInfoFetched) {
                    getCDNinfo();
                }
            }

            // ä½¿ç”¨å¤šç§æ–¹å¼ç¡®ä¿CDNæ£€æµ‹èƒ½æ­£å¸¸å·¥ä½œ
            function setupCDNDetection() {
                // æ–¹æ³•1: DOMContentLoadedäº‹ä»¶
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', initCDN);
                } else {
                    initCDN();
                }

                // æ–¹æ³•2: ä½¿ç”¨setTimeoutç¡®ä¿åœ¨DOMå®Œå…¨åŠ è½½åæ‰§è¡Œ
                setTimeout(initCDN, 100);
                setTimeout(initCDN, 500);
                setTimeout(initCDN, 1000);

                // æ–¹æ³•3: ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼ˆä¼˜åŒ–ç‰ˆæœ¬ï¼‰
                let resizeTimer;
                window.addEventListener('resize', function() {
                    clearTimeout(resizeTimer);
                    resizeTimer = setTimeout(function() {
                        // åªåœ¨å¿…è¦æ—¶é‡æ–°åˆå§‹åŒ–ï¼ˆæ¯”å¦‚æ–°æ·»åŠ çš„CDNå…ƒç´ ï¼‰
                        const cdnElements = document.querySelectorAll('#cdn');
                        let hasNewElements = false;
                        cdnElements.forEach(cdnElement => {
                            if (cdnElement && cdnElement.textContent && cdnElement.textContent.includes("æ£€æµ‹ä¸­")) {
                                hasNewElements = true;
                            }
                        });
                        
                        // åªæœ‰å½“æœ‰æ–°å…ƒç´ éœ€è¦åˆå§‹åŒ–æ—¶æ‰é‡æ–°æ‰§è¡Œ
                        if (hasNewElements) {
                            initCDN();
                        }
                    }, 300);
                });

                // æ–¹æ³•4: ä½¿ç”¨MutationObserverç›‘å¬DOMå˜åŒ–
                if (typeof MutationObserver !== 'undefined') {
                    const observer = new MutationObserver(function(mutations) {
                        let shouldReinit = false;
                        mutations.forEach(function(mutation) {
                            if (mutation.type === 'childList') {
                                mutation.addedNodes.forEach(function(node) {
                                    if (node.nodeType === 1 && (node as Element).id === 'cdn') {
                                        shouldReinit = true;
                                    }
                                });
                            }
                        });
                        if (shouldReinit) {
                            setTimeout(initCDN, 100);
                        }
                    });

                    if (document.body) {
                        observer.observe(document.body, {
                            childList: true,
                            subtree: true
                        });
                    }
                }

                // æ–¹æ³•5: å®šæœŸæ£€æŸ¥å¹¶é‡æ–°åˆå§‹åŒ–ï¼ˆä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆï¼Œä½†é¢‘ç‡é™ä½ï¼‰
                setInterval(function() {
                    const cdnElements = document.querySelectorAll('#cdn');
                    let shouldReinit = false;
                    cdnElements.forEach(cdnElement => {
                        if (cdnElement && cdnElement.textContent && cdnElement.textContent.includes("æ£€æµ‹ä¸­")) {
                            shouldReinit = true;
                        }
                    });
                    if (shouldReinit) {
                        initCDN();
                    }
                }, 10000); // ä»5ç§’æ”¹ä¸º10ç§’ï¼Œå‡å°‘æ£€æŸ¥é¢‘ç‡
            }

            // å¯åŠ¨CDNæ£€æµ‹ç³»ç»Ÿ
            setupCDNDetection();
        </script>
    </div>
</div>